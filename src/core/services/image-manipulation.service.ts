import * as sharp from 'sharp';

export async function compressImage(image: any) {
  return await sharp(image)
    .webp()
    .rotate(image.exifOrientation)
    .toBuffer()

    .then((data: any) => {
      return sharp(data)
        .composite([
          {
            input: Buffer.from(
              `<svg width="97" height="34" viewBox="0 0 97 34" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M19.816 1.3C20.392 1.3 20.86 1.492 21.22 1.876C21.58 2.26 21.76 2.74 21.76 3.316V24.304C21.76 24.928 21.544 25.456 21.112 25.888C20.704 26.296 20.188 26.5 19.564 26.5C19.252 26.5 18.928 26.452 18.592 26.356C18.28 26.236 18.04 26.08 17.872 25.888L3.724 7.924L4.66 7.348V24.484C4.66 25.06 4.468 25.54 4.084 25.924C3.724 26.308 3.244 26.5 2.644 26.5C2.068 26.5 1.6 26.308 1.24 25.924C0.88 25.54 0.7 25.06 0.7 24.484V3.496C0.7 2.872 0.904 2.356 1.312 1.948C1.744 1.516 2.272 1.3 2.896 1.3C3.232 1.3 3.58 1.372 3.94 1.516C4.3 1.636 4.564 1.828 4.732 2.092L18.448 19.588L17.836 20.02V3.316C17.836 2.74 18.016 2.26 18.376 1.876C18.736 1.492 19.216 1.3 19.816 1.3ZM42.5807 6.88C43.2047 6.88 43.7207 7.084 44.1287 7.492C44.5367 7.9 44.7407 8.428 44.7407 9.076V24.304C44.7407 24.928 44.5367 25.456 44.1287 25.888C43.7207 26.296 43.2047 26.5 42.5807 26.5C41.9567 26.5 41.4407 26.296 41.0327 25.888C40.6247 25.456 40.4207 24.928 40.4207 24.304V22.54L41.2127 22.864C41.2127 23.176 41.0447 23.56 40.7087 24.016C40.3727 24.448 39.9167 24.88 39.3407 25.312C38.7647 25.744 38.0807 26.116 37.2887 26.428C36.5207 26.716 35.6807 26.86 34.7687 26.86C33.1127 26.86 31.6127 26.44 30.2687 25.6C28.9247 24.736 27.8567 23.56 27.0647 22.072C26.2967 20.56 25.9127 18.832 25.9127 16.888C25.9127 14.92 26.2967 13.192 27.0647 11.704C27.8567 10.192 28.9127 9.016 30.2327 8.176C31.5527 7.312 33.0167 6.88 34.6247 6.88C35.6567 6.88 36.6047 7.036 37.4687 7.348C38.3327 7.66 39.0767 8.056 39.7007 8.536C40.3487 9.016 40.8407 9.508 41.1767 10.012C41.5367 10.492 41.7167 10.9 41.7167 11.236L40.4207 11.704V9.076C40.4207 8.452 40.6247 7.936 41.0327 7.528C41.4407 7.096 41.9567 6.88 42.5807 6.88ZM35.3087 22.9C36.3647 22.9 37.2887 22.636 38.0807 22.108C38.8727 21.58 39.4847 20.86 39.9167 19.948C40.3727 19.036 40.6007 18.016 40.6007 16.888C40.6007 15.736 40.3727 14.704 39.9167 13.792C39.4847 12.88 38.8727 12.16 38.0807 11.632C37.2887 11.104 36.3647 10.84 35.3087 10.84C34.2767 10.84 33.3647 11.104 32.5727 11.632C31.7807 12.16 31.1567 12.88 30.7007 13.792C30.2687 14.704 30.0527 15.736 30.0527 16.888C30.0527 18.016 30.2687 19.036 30.7007 19.948C31.1567 20.86 31.7807 21.58 32.5727 22.108C33.3647 22.636 34.2767 22.9 35.3087 22.9ZM53.4861 24.304C53.4861 24.928 53.2821 25.456 52.8741 25.888C52.4661 26.296 51.9501 26.5 51.3261 26.5C50.7021 26.5 50.1861 26.296 49.7781 25.888C49.3701 25.456 49.1661 24.928 49.1661 24.304V9.436C49.1661 8.812 49.3701 8.296 49.7781 7.888C50.1861 7.456 50.7021 7.24 51.3261 7.24C51.9501 7.24 52.4661 7.456 52.8741 7.888C53.2821 8.296 53.4861 8.812 53.4861 9.436V24.304ZM51.2901 4.9C50.4741 4.9 49.8981 4.768 49.5621 4.504C49.2261 4.24 49.0581 3.772 49.0581 3.1V2.416C49.0581 1.72 49.2381 1.252 49.5981 1.012C49.9821 0.747999 50.5581 0.615999 51.3261 0.615999C52.1661 0.615999 52.7541 0.747999 53.0901 1.012C53.4261 1.276 53.5941 1.744 53.5941 2.416V3.1C53.5941 3.796 53.4141 4.276 53.0541 4.54C52.6941 4.78 52.1061 4.9 51.2901 4.9ZM72.2179 7.24C72.8419 7.24 73.3579 7.456 73.7659 7.888C74.1739 8.296 74.3779 8.812 74.3779 9.436V24.736C74.3779 26.944 73.9579 28.696 73.1179 29.992C72.3019 31.312 71.1979 32.26 69.8059 32.836C68.4139 33.412 66.8539 33.7 65.1259 33.7C64.3579 33.7 63.5419 33.64 62.6779 33.52C61.8139 33.4 61.1059 33.22 60.5539 32.98C59.8339 32.668 59.3299 32.272 59.0419 31.792C58.7779 31.336 58.7299 30.844 58.8979 30.316C59.1139 29.62 59.4619 29.14 59.9419 28.876C60.4219 28.636 60.9259 28.612 61.4539 28.804C61.8379 28.924 62.3419 29.104 62.9659 29.344C63.5899 29.608 64.3099 29.74 65.1259 29.74C66.2299 29.74 67.1419 29.584 67.8619 29.272C68.6059 28.984 69.1579 28.48 69.5179 27.76C69.9019 27.064 70.0939 26.104 70.0939 24.88V22.468L70.8499 23.332C70.4419 24.124 69.9259 24.784 69.3019 25.312C68.7019 25.816 67.9819 26.2 67.1419 26.464C66.3019 26.728 65.3419 26.86 64.2619 26.86C62.9899 26.86 61.8739 26.572 60.9139 25.996C59.9779 25.396 59.2459 24.58 58.7179 23.548C58.1899 22.492 57.9259 21.292 57.9259 19.948V9.436C57.9259 8.812 58.1299 8.296 58.5379 7.888C58.9459 7.456 59.4619 7.24 60.0859 7.24C60.7099 7.24 61.2259 7.456 61.6339 7.888C62.0419 8.296 62.2459 8.812 62.2459 9.436V18.652C62.2459 20.212 62.5819 21.316 63.2539 21.964C63.9499 22.588 64.9099 22.9 66.1339 22.9C66.9739 22.9 67.6819 22.744 68.2579 22.432C68.8339 22.096 69.2779 21.616 69.5899 20.992C69.9019 20.344 70.0579 19.564 70.0579 18.652V9.436C70.0579 8.812 70.2619 8.296 70.6699 7.888C71.0779 7.456 71.5939 7.24 72.2179 7.24ZM94.8228 6.88C95.4468 6.88 95.9628 7.084 96.3708 7.492C96.7788 7.9 96.9828 8.428 96.9828 9.076V24.304C96.9828 24.928 96.7788 25.456 96.3708 25.888C95.9628 26.296 95.4468 26.5 94.8228 26.5C94.1988 26.5 93.6828 26.296 93.2748 25.888C92.8668 25.456 92.6628 24.928 92.6628 24.304V22.54L93.4548 22.864C93.4548 23.176 93.2868 23.56 92.9508 24.016C92.6148 24.448 92.1588 24.88 91.5828 25.312C91.0068 25.744 90.3228 26.116 89.5308 26.428C88.7628 26.716 87.9228 26.86 87.0108 26.86C85.3548 26.86 83.8548 26.44 82.5108 25.6C81.1668 24.736 80.0988 23.56 79.3068 22.072C78.5388 20.56 78.1548 18.832 78.1548 16.888C78.1548 14.92 78.5388 13.192 79.3068 11.704C80.0988 10.192 81.1548 9.016 82.4748 8.176C83.7948 7.312 85.2588 6.88 86.8668 6.88C87.8988 6.88 88.8468 7.036 89.7108 7.348C90.5748 7.66 91.3188 8.056 91.9428 8.536C92.5908 9.016 93.0828 9.508 93.4188 10.012C93.7788 10.492 93.9588 10.9 93.9588 11.236L92.6628 11.704V9.076C92.6628 8.452 92.8668 7.936 93.2748 7.528C93.6828 7.096 94.1988 6.88 94.8228 6.88ZM87.5508 22.9C88.6068 22.9 89.5308 22.636 90.3228 22.108C91.1148 21.58 91.7268 20.86 92.1588 19.948C92.6148 19.036 92.8428 18.016 92.8428 16.888C92.8428 15.736 92.6148 14.704 92.1588 13.792C91.7268 12.88 91.1148 12.16 90.3228 11.632C89.5308 11.104 88.6068 10.84 87.5508 10.84C86.5188 10.84 85.6068 11.104 84.8148 11.632C84.0228 12.16 83.3988 12.88 82.9428 13.792C82.5108 14.704 82.2948 15.736 82.2948 16.888C82.2948 18.016 82.5108 19.036 82.9428 19.948C83.3988 20.86 84.0228 21.58 84.8148 22.108C85.6068 22.636 86.5188 22.9 87.5508 22.9Z" fill="#F90047"/>
                 </svg>`,
            ),
            // tile: true,
            gravity: 'southeast',
          },
        ])
        .toBuffer();
    })
    .catch((error: any) => {
      console.error('Error:', error);
    });
}
